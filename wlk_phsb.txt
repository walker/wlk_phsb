# wlk_phsb v1.0
# A pubsubhubbub plugin to enable the pushbutton web.
# Walker Hamilton
# http://walkerhamilton.com

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMDp7czo3OiJ2ZXJzaW9uIjtzOjM6IjEuMCI7czo2OiJhdXRob3IiO3M6MTU6IldhbGtl
ciBIYW1pbHRvbiI7czoxMDoiYXV0aG9yX3VyaSI7czoyNToiaHR0cDovL3dhbGtlcmhhbWls
dG9uLmNvbSI7czoxMToiZGVzY3JpcHRpb24iO3M6NTE6IkEgcHVic3ViaHViYnViIHBsdWdp
biB0byBlbmFibGUgdGhlIHB1c2hidXR0b24gd2ViLiI7czo0OiJ0eXBlIjtpOjE7czo1OiJm
bGFncyI7aToyO3M6NDoibmFtZSI7czo4OiJ3bGtfcGhzYiI7czo0OiJoZWxwIjtzOjUwNDoi
CTxoMj5BYm91dDwvaDI+CgoJPHA+VGhpcyBwbHVnaW4gZW5hYmxlcyA8YSBocmVmPSJodHRw
Oi8vY29kZS5nb29nbGUuY29tL3AvcHVic3ViaHViYnViIj5wdWJzdWJodWJidWI8L2E+IHN1
cHBvcnQgZm9yIGJ1aWx0LWluIHRleHRwYXR0ZXJuIGZlZWRzLiAoUmVxdWlyZXMgPHNwYW4g
Y2xhc3M9ImNhcHMiPkNVUkw8L3NwYW4+KTwvcD4KCgk8aDI+SW5zdGFsbGF0aW9uIGFuZCBV
c2U8L2gyPgoKCTxwPklmIHlvdSYjODIxNzt2ZSBpbnN0YWxsZWQgYW5kIGFjdGl2YXRlZCBp
dCwgeW91JiM4MjE3O3JlIHJlYWR5IHRvIGdvLjwvcD4KCgk8aDI+VGhhbmtzPC9oMj4KCgk8
cD5UaGUgcHVibGlzaGVyIGNsYXNzIHdhcyB3cml0dGVuIGJ5IEpvc2ggRnJhemVyIChqb3No
ZnJhc2VyLmNvbSkgYmVmb3JlIGJlaW5nIG1vZGlmaWVkIHNsaWdodGx5IGZvciB1c2UgaGVy
ZS4gSm9zaCBhbHNvIHdyb3RlIHRoZSBXb3JkcHJlc3MgcGx1Z2luIHRoYXQgSSBiYXNlZCB0
aGlzIHBsdWdpbiBvbi48L3A+IjtzOjQ6ImNvZGUiO3M6MTEyNDU6IgpyZWdpc3Rlcl9jYWxs
YmFjaygnd2xrX3Boc2JfcnNzX2hlYWQnLCAncnNzX2hlYWQnKTsKcmVnaXN0ZXJfY2FsbGJh
Y2soJ3dsa19waHNiX2F0b21faGVhZCcsICdhdG9tX2hlYWQnKTsKCmlmKEB0eHBpbnRlcmZh
Y2UgPT0gJ2FkbWluJykKewoJcmVnaXN0ZXJfY2FsbGJhY2soJ3dsa19waHNiX2luc3RhbGwn
LCAncGx1Z2luX2xpZmVjeWNsZS53bGtfcGhzYicsICdpbnN0YWxsZWQnKTsKCXJlZ2lzdGVy
X2NhbGxiYWNrKCd3bGtfcGhzYl9kZWxldGUnLCAncGx1Z2luX2xpZmVjeWNsZS53bGtfcGhz
YicsICdkZWxldGVkJyk7CglyZWdpc3Rlcl9jYWxsYmFjaygnd2xrX3Boc2JfbGFuZ3VhZ2Un
LCAnYWRtaW5fc2lkZScsICdwYWdldG9wJyk7CglyZWdpc3Rlcl9jYWxsYmFjaygnd2xrX3Bo
c2Jfc2NoZWR1bGUnLCAnYXJ0aWNsZScsICdlZGl0Jyk7Cn0KCmZ1bmN0aW9uIHdsa19waHNi
X3NjaGVkdWxlKCkgewoJJHBjID0gbmV3IFdsa1Boc2JDbGFzcygpOwoJJHBjLT5zY2hlZHVs
ZV9wb3N0X25vdGlmaWNhdGlvbnMoKTsKfQoKZnVuY3Rpb24gd2xrX3Boc2JfcnNzX2hlYWQo
KSB7CgkkcGMgPSBuZXcgV2xrUGhzYkNsYXNzKCk7CglyZXR1cm4gJHBjLT5yc3NfaGVhZCgp
Owp9CgpmdW5jdGlvbiB3bGtfcGhzYl9hdG9tX2hlYWQoKSB7CgkkcGMgPSBuZXcgV2xrUGhz
YkNsYXNzKCk7CglyZXR1cm4gJHBjLT5hdG9tX2hlYWQoKTsKfQoKZnVuY3Rpb24gd2xrX3Bo
c2JfaW5zdGFsbCgpIHsKCSRwYyA9IG5ldyBXbGtQaHNiQ2xhc3MoKTsKCSRwYy0+aW5zdGFs
bCgpOwp9CgpmdW5jdGlvbiB3bGtfcGhzYl9kZWxldGUoKSB7CgkkcGMgPSBuZXcgV2xrUGhz
YkNsYXNzKCk7CgkkcGMtPmRlbGV0ZSgpOwp9CgpmdW5jdGlvbiB3bGtfcGhzYl9sYW5ndWFn
ZSgpIHsKCSRwYyA9IG5ldyBXbGtQaHNiQ2xhc3MoKTsKfQoKZnVuY3Rpb24gd2xrX3Boc2Jf
dGV4dGFyZWEoKSB7CgkkcGMgPSBuZXcgV2xrUGhzYkNsYXNzKCk7CglyZXR1cm4gJHBjLT5l
bmRwb2ludHNfdGV4dGFyZWEoKTsKfQoKLy8KY2xhc3MgV2xrUGhzYkNsYXNzIHsKCXZhciAk
dmFycyA9IGFycmF5KAoJCSdub3RpZmljYXRpb25zX2luc3RhbnQnID0+IHRydWUsCgkJJ3Vz
ZXJfYWdlbnQnID0+ICdUZXh0cGF0dGVybi9QSFNCIDAuMicsCgkJJ21heF9mYWlsdXJlcycg
PT4gNSwKCQkndGltZW91dCcgPT4gMywKCQknZW5kcG9pbnRzJyA9PiBhcnJheSgiaHR0cDov
L3B1YnN1Ymh1YmJ1Yi5hcHBzcG90LmNvbSIsICJodHRwOi8vc3VwZXJmZWVkci5jb20vaHVi
YnViIikKCSk7CgoJZnVuY3Rpb24gX19jb25zdHJ1Y3QoKSB7CgkJZ2xvYmFsICRwcmVmcywg
JHRleHRhcnJheTsKCgkJaWYoJHByZWZzWydsYW5ndWFnZSddPT0nZW4tdXMnKSB7CgkJCSR0
ZXh0YXJyYXlbJ3dsa19waHNiJ10gPSAnUHViU3ViSHViQnViJzsKCQkJJHRleHRhcnJheVsn
cnNzY2xvdWRfc3RhbmRhcmQnXSA9ICdTdGFuZGFyZCBmZWVkcyc7CgkJCSR0ZXh0YXJyYXlb
J3Jzc2Nsb3VkX2JvdGgnXSA9ICdCb3RoIHN0YW5kYXJkIGZlZWRzICYgdGhlIGN1c3RvbSBm
ZWVkJzsKCQkJJHRleHRhcnJheVsncnNzY2xvdWRfY3VzdG9tX29ubHknXSA9ICdDdXN0b20g
ZmVlZCBvbmx5JzsKCQkJJHRleHRhcnJheVsnd2xrX3Boc2Jfbm90aWZpY2F0aW9uc19pbnN0
YW50J10gPSAnSW5zdGFudCBub3RpZmljYXRpb25zPyAoIk5vIiByZXF1aXJlcyB3bGtfY3Jv
biknOwoJCQkkdGV4dGFycmF5Wyd3bGtfcGhzYl9lbmRwb2ludHMnXSA9ICdQSFNCIFNlcnZl
cnMgKHNlcGFyYXRlIGxpbmVzKSc7CgkJfQoKCQlpZihpc3NldCgkcHJlZnNbJ3dsa19waHNi
X25vdGlmaWNhdGlvbnNfaW5zdGFudCddKSAmJiAhZW1wdHkoJHByZWZzWyd3bGtfcGhzYl9u
b3RpZmljYXRpb25zX2luc3RhbnQnXSkpIHsgJHRoaXMtPnZhcnNbJ25vdGlmaWNhdGlvbnNf
aW5zdGFudCddID0gKGJvb2wpJHByZWZzWyd3bGtfcGhzYl9ub3RpZmljYXRpb25zX2luc3Rh
bnQnXTsgfQoJCWlmKGlzc2V0KCRwcmVmc1snd2xrX3Boc2JfbWF4X2ZhaWx1cmVzJ10pICYm
ICFlbXB0eSgkcHJlZnNbJ3dsa19waHNiX21heF9mYWlsdXJlcyddKSkgeyAkdGhpcy0+dmFy
c1snbWF4X2ZhaWx1cmVzJ10gPSAoaW50KSRwcmVmc1snd2xrX3Boc2JfbWF4X2ZhaWx1cmVz
J107IH0KCQlpZihpc3NldCgkcHJlZnNbJ3dsa19waHNiX3RpbWVvdXQnXSkgJiYgIWVtcHR5
KCRwcmVmc1snd2xrX3Boc2JfdGltZW91dCddKSkgeyAkdGhpcy0+dmFyc1sndGltZW91dCdd
ID0gKGludCkkcHJlZnNbJ3dsa19waHNiX3RpbWVvdXQnXTsgfQoJCWlmKGlzc2V0KCRwcmVm
c1snd2xrX3Boc2JfdXNlcl9hZ2VudCddKSAmJiAhZW1wdHkoJHByZWZzWyd3bGtfcGhzYl91
c2VyX2FnZW50J10pKSB7ICR0aGlzLT52YXJzWyd1c2VyX2FnZW50J10gPSAkcHJlZnNbJ3ds
a19waHNiX3VzZXJfYWdlbnQnXTsgfQoJCWlmKGlzc2V0KCRwcmVmc1snd2xrX3Boc2JfZW5k
cG9pbnRzJ10pICYmICFlbXB0eSgkcHJlZnNbJ3dsa19waHNiX2VuZHBvaW50cyddKSkgewoJ
CQkkdGhpcy0+dmFyc1snZW5kcG9pbnRzJ10gPSBleHBsb2RlKCJcbiIsICRwcmVmc1snd2xr
X3Boc2JfZW5kcG9pbnRzJ10pOwoJCQkvLyBjbGVhbiBvdXQgYW55IGJsYW5rIHZhbHVlcwoJ
CQlmb3JlYWNoICgkdGhpcy0+dmFyc1snZW5kcG9pbnRzJ10gYXMgJGtleSA9PiAkdmFsdWUp
IHsKCQkJCWlmIChpc19udWxsKCR2YWx1ZSkgfHwgJHZhbHVlPT0iIikgewoJCQkJCXVuc2V0
KCR0aGlzLT52YXJzWydlbmRwb2ludHMnXVska2V5XSk7CgkJCQl9IGVsc2UgewoJCQkJCSR0
aGlzLT52YXJzWydlbmRwb2ludHMnXVska2V5XSA9IHRyaW0oJHRoaXMtPnZhcnNbJ2VuZHBv
aW50cyddWyRrZXldKTsKCQkJCX0KCQkJfQoJCQkkdGhpcy0+dmFyc1snZW5kcG9pbnRzJ10g
PSBhcnJheV9tZXJnZSgkdGhpcy0+dmFyc1snZW5kcG9pbnRzJ10pOwoJCX0KCX0KCglmdW5j
dGlvbiBXbGtQaHNiQ2xhc3MoKSB7CgkJJHRoaXMtPl9fY29uc3RydWN0KCk7Cgl9CgoJZnVu
Y3Rpb24gYXRvbV9oZWFkKCkgewoJCSRodWJfdXJscyA9ICR0aGlzLT5nZXRfcHVic3ViX2Vu
ZHBvaW50cygpOwoJCSRmaW5hbCA9ICcnOwoJCWZvcmVhY2ggKCRodWJfdXJscyBhcyAkaHVi
X3VybCkgewoJCQkkZmluYWwgLj0gJzxsaW5rIHJlbD0iaHViIiBocmVmPSInLiRodWJfdXJs
LiciIC8+Jy4iXHJcbiI7CgkJfQoJCXJldHVybiAkZmluYWw7Cgl9CgoJZnVuY3Rpb24gcnNz
X2hlYWQoKSB7CgkJJGh1Yl91cmxzID0gJHRoaXMtPmdldF9wdWJzdWJfZW5kcG9pbnRzKCk7
CgkJJGZpbmFsID0gJyc7CgkJZm9yZWFjaCAoJGh1Yl91cmxzIGFzICRodWJfdXJsKSB7CgkJ
CSRmaW5hbCAuPSAnPGF0b206bGluayByZWw9Imh1YiIgaHJlZj0iJy4kaHViX3VybC4nIi8+
Jy4iXHJcbiI7CgkJfQoJCXJldHVybiAkZmluYWw7Cgl9CgoJZnVuY3Rpb24gc2NoZWR1bGVf
cG9zdF9ub3RpZmljYXRpb25zKCkgewoJCWlmKCR0aGlzLT52YXJzWydub3RpZmljYXRpb25z
X2luc3RhbnQnXSAmJiBmdW5jdGlvbl9leGlzdHMoJ3dsa19jcm9uX3NpbmdsZV9ldmVudCcp
KSB7CgkJCS8vIFRPRE86IGNyZWF0ZSB3bGtfY3JvbiBQbHVnaW4KCQkJd2xrX2Nyb25fc2lu
Z2xlX2V2ZW50KHRpbWUoKSwgJ3NlbmRfcG9zdF9ub3RpZmljYXRpb25zX2FjdGlvbicpOwoJ
CX0gZWxzZSB7CgkJCSR0aGlzLT5zZW5kX3Bvc3Rfbm90aWZpY2F0aW9ucygpOwoJCX0KCX0K
CglmdW5jdGlvbiBzZW5kX3Bvc3Rfbm90aWZpY2F0aW9ucygpIHsKCQlnbG9iYWwgJHByZWZz
OwoJCSRzZW5kX3VkID0gZmFsc2U7CgkJaWYoIWVtcHR5KCRfUE9TVCkgJiYgaXNzZXQoJF9Q
T1NUWydJRCddKSkgewoJCQlpZihpc19udW1lcmljKCRfUE9TVFsnSUQnXSkpIHsKCQkJCSRh
ID0gc2FmZV9yb3coJ1N0YXR1cycsICd0ZXh0cGF0dGVybicsICdJRD0nLmludHZhbCgkaWQp
KTsKCQkJCWlmICgkYSkgewoJCQkJCWlmKCR1RXhwaXJlcyBhbmQgdGltZSgpID4gJHVFeHBp
cmVzIGFuZCAhJHByZWZzWydwdWJsaXNoX2V4cGlyZWRfYXJ0aWNsZXMnXSkgewoJCQkJCQkk
c2VuZF91ZCA9IGZhbHNlOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJCWlmKCgkYVsnU3Rh
dHVzJ10hPTQgfHwgJGFbJ1N0YXR1cyddIT01KSAmJiAoJF9QT1NUWydTdGF0dXMnXT09NCB8
fCAkX1BPU1RbJ1N0YXR1cyddPT01KSkgewoJCQkJCQkvLyBzdGF0dXMgY2hhbmdlZCB0byBw
dWJsaXNoZWQKCQkJCQkJJHNlbmRfdWQgPSB0cnVlOwoJCQkJCX0gZWxzZSB7CgkJCQkJCS8v
IHN0YXR1cyBkaWRuJ3QgY2hhbmdlIHRvIHB1Ymxpc2hlZAoJCQkJCQkkc2VuZF91ZCA9IGZh
bHNlOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQkkc2VuZF91ZCA9
IGZhbHNlOwoJCQkJfQoJCQl9IGVsc2UgaWYoKCFpc19udW1lcmljKCRfUE9TVFsnSUQnXSkg
fHwgZW1wdHkoJF9QT1NUWydJRCddKSkgJiYgKCRfUE9TVFsnU3RhdHVzJ109PTQgfHwgJF9Q
T1NUWydTdGF0dXMnXT09NSkpIHsKCQkJCWlmKCEkdGhpcy0+ZXhwaXJlZCgkX1BPU1QpICYm
ICR0aGlzLT5wdWJsaXNoZWQoJF9QT1NUKSkgewoJCQkJCSRzZW5kX3VkID0gdHJ1ZTsKCQkJ
CX0gZWxzZSBpZighJHRoaXMtPmV4cGlyZWQoJF9QT1NUKSAmJiAhJHRoaXMtPnB1Ymxpc2hl
ZCgkX1BPU1QpKSB7CgkJCQkJLy8gVE9ETzogU2V0IGNyb24KCQkJCQkkc2VuZF91ZCA9IGZh
bHNlOwoJCQkJCXJldHVybjsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIGVycm9yIQoJCQkJ
JHNlbmRfdWQgPSBmYWxzZTsKCQkJCXJldHVybjsKCQkJfQoJCX0KCgkJaWYoJHNlbmRfdWQp
IHsKCQkJJHVybHMgPSBhcnJheSgpOwoKCQkJaWYoJHByZWZzWyd3bGtfcGhzYl9mZWVkcydd
PT0nY3VzdG9tX29ubHknIHx8ICRwcmVmc1snd2xrX3Boc2JfZmVlZHMnXT09J2JvdGgnKSB7
CgkJCQkkdXJsc1tdID0gJHByZWZzWydjdXN0b21fdXJsJ107CgkJCX0KCgkJCWlmKCRwcmVm
c1snd2xrX3Boc2JfZmVlZHMnXT09J2JvdGgnIHx8ICRwcmVmc1snd2xrX3Boc2JfZmVlZHMn
XT09J3N0YW5kYXJkJykgewoJCQkJLy8gZ2V0IHRoZSBzZWN0aW9uLCBjYXRlZ29yeSwgJiAi
QWxsIgoJCQkJJGZycyA9IHNhZmVfY29sdW1uKCJuYW1lIiwgInR4cF9zZWN0aW9uIiwgImlu
X3JzcyAhPSAnMSciKTsKCQkJCWlmKGlzc2V0KCRfUE9TVFsnU2VjdGlvbiddKSAmJiBpbl9h
cnJheSgkX1BPU1RbJ1NlY3Rpb24nXSwgJGZycykpIHsKCQkJCQkvLyBjYW4ndCBzZW5kIHRo
YXQgc2VjdGlvbgoJCQkJfSBlbHNlIHsKCQkJCQkvLyBjb25zdHJ1Y3QgdGhlIGZlZWQgVVJM
cwoJCQkJCS8vIGFkZCB0byB0aGUgVVJMcyBhcnJheQoJCQkJCSR1cmxzW10gPSBodS4ncnNz
Lyc7CgoJCQkJCWlmKGlzc2V0KCRfUE9TVFsnU2VjdGlvbiddKSAmJiAhZW1wdHkoJF9QT1NU
WydTZWN0aW9uJ10pKSB7CgkJCQkJCSR1cmxzW10gPSBodS4ncnNzLz9zZWN0aW9uPScuJF9Q
T1NUWydTZWN0aW9uJ107CgkJCQkJfQoKCQkJCQlpZihpc3NldCgkX1BPU1RbJ0NhdGVnb3J5
MSddKSAmJiAhZW1wdHkoJF9QT1NUWydDYXRlZ29yeTEnXSkpIHsKCQkJCQkJJHVybHNbXSA9
IGh1Lidyc3MvP2NhdGVnb3J5PScuJF9QT1NUWydDYXRlZ29yeTEnXTsKCQkJCQkJaWYoaXNz
ZXQoJF9QT1NUWydTZWN0aW9uJ10pICYmICFlbXB0eSgkX1BPU1RbJ1NlY3Rpb24nXSkpIHsK
CQkJCQkJCSR1cmxzW10gPSBodS4ncnNzLz9zZWN0aW9uPScuJF9QT1NUWydTZWN0aW9uJ10u
JyZjYXRlZ29yeT0nLiRfUE9TVFsnQ2F0ZWdvcnkxJ107CgkJCQkJCX0KCQkJCQl9CgoJCQkJ
CWlmKGlzc2V0KCRfUE9TVFsnQ2F0ZWdvcnkyJ10pICYmICFlbXB0eSgkX1BPU1RbJ0NhdGVn
b3J5MiddKSkgewoJCQkJCQkkdXJsc1tdID0gaHUuJ3Jzcy8/Y2F0ZWdvcnk9Jy4kX1BPU1Rb
J0NhdGVnb3J5MiddOwoJCQkJCQlpZihpc3NldCgkX1BPU1RbJ1NlY3Rpb24nXSkgJiYgIWVt
cHR5KCRfUE9TVFsnU2VjdGlvbiddKSkgewoJCQkJCQkJJHVybHNbXSA9IGh1Lidyc3MvP3Nl
Y3Rpb249Jy4kX1BPU1RbJ1NlY3Rpb24nXS4nJmNhdGVnb3J5PScuJF9QT1NUWydDYXRlZ29y
eTInXTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJaWYoIWVtcHR5KCR1cmxzKSkK
CQkJewoJCQkJJGZlZWRfdXJscyA9IGFycmF5X3VuaXF1ZSgkdXJscyk7CgkJCQkvLyBnZXQg
dGhlIGxpc3Qgb2YgaHVicwoJCQkJJGh1Yl91cmxzID0gJHRoaXMtPmdldF9wdWJzdWJfZW5k
cG9pbnRzKCk7CgkJCQkvLyBsb29wIHRocm91Z2ggZWFjaCBodWIKCQkJCWZvcmVhY2ggKCRo
dWJfdXJscyBhcyAkaHViX3VybCkKCQkJCXsKCQkJCQkkcCA9IG5ldyBQdWJsaXNoZXIoJGh1
Yl91cmwsICR0aGlzLT52YXJzWyd1c2VyX2FnZW50J10pOwoJCQkJCS8vIHB1Ymxpc2ggdGhl
IHVwZGF0ZSB0byBlYWNoIGh1YgoJCQkJCWlmICghJHAtPnB1Ymxpc2hfdXBkYXRlKCRmZWVk
X3VybHMpKQoJCQkJCXsKCQkJCQkJLy8gVE9ETzogYWRkIGJldHRlciBlcnJvciBoYW5kbGlu
ZyBoZXJlCgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQoKCWZ1bmN0aW9uIHB1Ymxpc2hlZCgk
cG9zdCkgewoJCSR3aGVuX3RzID0gdGltZSgpOwoKCQlpZihpc3NldCgkcG9zdFsncmVzZXRf
dGltZSddKSkgewoJCQlyZXR1cm4gdHJ1ZTsKCQl9IGVsc2UgewoJCQlpZiAoIWlzX251bWVy
aWMoJHBvc3RbJ3llYXInXSkgfHwgIWlzX251bWVyaWMoJHBvc3RbJ21vbnRoJ10pIHx8ICFp
c19udW1lcmljKCRwb3N0WydkYXknXSkgfHwgIWlzX251bWVyaWMoJHBvc3RbJ2hvdXInXSkg
IHx8ICFpc19udW1lcmljKCRwb3N0WydtaW51dGUnXSkgfHwgIWlzX251bWVyaWMoJHBvc3Rb
J3NlY29uZCddKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQkkdHMgPSBzdHJ0b3Rp
bWUoJHBvc3RbJ3llYXInXS4nLScuJHBvc3RbJ21vbnRoJ10uJy0nLiRwb3N0WydkYXknXS4n
ICcuJHBvc3RbJ2hvdXInXS4nOicuJHBvc3RbJ21pbnV0ZSddLic6Jy4kcG9zdFsnc2Vjb25k
J10pOwoJCQlpZiAoJHRzID09PSBmYWxzZSB8fCAkdHMgPT09IC0xKSB7CgkJCQlyZXR1cm4g
ZmFsc2U7CgkJCX0KCgkJCSR3aGVuID0gJHdoZW5fdHMgPSAkdHMgLSB0el9vZmZzZXQoJHRz
KTsKCgkJCWlmKCR3aGVuPD10aW1lKCkpCgkJCQlyZXR1cm4gdHJ1ZTsKCQkJZWxzZQoJCQkJ
cmV0dXJuIGZhbHNlOwoJCX0KCX0KCglmdW5jdGlvbiBleHBpcmVkKCRwb3N0KSB7CgkJaWYo
aXNzZXQoJHBvc3RbJ2V4cF95ZWFyJ10pICYmICFlbXB0eSgkcG9zdFsnZXhwX3llYXInXSkp
IHsKCQkJaWYoZW1wdHkoJHBvc3RbJ2V4cF9tb250aCddKSkgJHBvc3RbJ2V4cF9tb250aCdd
PTE7CgkJCWlmKGVtcHR5KCRwb3N0WydleHBfZGF5J10pKSAkcG9zdFsnZXhwX2RheSddPTE7
CgkJCWlmKGVtcHR5KCRwb3N0WydleHBfaG91ciddKSkgJHBvc3RbJ2V4cF9ob3VyJ109MDsK
CQkJaWYoZW1wdHkoJHBvc3RbJ2V4cF9taW51dGUnXSkpICRwb3N0WydleHBfbWludXRlJ109
MDsKCQkJaWYoZW1wdHkoJHBvc3RbJ2V4cF9zZWNvbmQnXSkpICRwb3N0WydleHBfc2Vjb25k
J109MDsKCgkJCSR0cyA9IHN0cnRvdGltZSgkcG9zdFsnZXhwX3llYXInXS4nLScuJHBvc3Rb
J2V4cF9tb250aCddLictJy4kcG9zdFsnZXhwX2RheSddLicgJy4kcG9zdFsnZXhwX2hvdXIn
XS4nOicuJHBvc3RbJ2V4cF9taW51dGUnXS4nOicuJHBvc3RbJ2V4cF9zZWNvbmQnXSk7CgkJ
CSRleHBpcmVzID0gJHRzIC0gdHpfb2Zmc2V0KCR0cyk7CgoJCQlpZigkZXhwaXJlczw9dGlt
ZSgpKQoJCQkJcmV0dXJuIHRydWU7CgkJCWVsc2UKCQkJCXJldHVybiBmYWxzZTsKCQl9IGVs
c2UgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoKCS8vIGdldCB0aGUgZW5kcG9pbnRzIGZy
b20gdGhlIHdvcmRwcmVzcyBvcHRpb25zIHRhYmxlCgkvLyB2YWxpZCBwYXJhbWV0ZXJzIGFy
ZSAicHVibGlzaCIgb3IgInN1YnNjcmliZSIKCWZ1bmN0aW9uIGdldF9wdWJzdWJfZW5kcG9p
bnRzKCkgewoJCXJldHVybiAkdGhpcy0+dmFyc1snZW5kcG9pbnRzJ107Cgl9CgoJZnVuY3Rp
b24gZW5kcG9pbnRzX3RleHRhcmVhKCkgewoJCXJldHVybiAnPHRleHRhcmVhIG5hbWU9Inds
a19waHNiX2VuZHBvaW50cyIgY29scz0iNTUiIHJvd3M9IjQiPicuaHRtbHNwZWNpYWxjaGFy
cyhpbXBsb2RlKCJcbiIsICR0aGlzLT52YXJzWydlbmRwb2ludHMnXSkpLic8L3RleHRhcmVh
Pic7Cgl9CgoJLyogSW5zdGFsbCBHb2VzIEhlcmUgKi8KCWZ1bmN0aW9uIGluc3RhbGwoKSB7
CgkJc2FmZV9xdWVyeSgnREVMRVRFIEZST00gJy5zYWZlX3BmeCgndHhwX3ByZWZzJykuJyBX
SEVSRSBuYW1lIExJS0UgIndsa19waHNiXyUiJyk7CgkJc2FmZV9pbnNlcnQoJ3R4cF9wcmVm
cycsInByZWZzX2lkID0gJzEnLG5hbWUgPSAnd2xrX3Boc2Jfbm90aWZpY2F0aW9uc19pbnN0
YW50Jyx2YWwgPSAnMScsdHlwZSA9ICcxJyxldmVudCA9ICd3bGtfcGhzYicsaHRtbCA9ICd5
ZXNub3JhZGlvJyxwb3NpdGlvbiA9ICcxMCcsdXNlcl9uYW1lID0gJyciKTsKCQlzYWZlX2lu
c2VydCgndHhwX3ByZWZzJywicHJlZnNfaWQgPSAnMScsbmFtZSA9ICd3bGtfcGhzYl9lbmRw
b2ludHMnLHZhbCA9ICciLmltcGxvZGUoIlxuIiwgJHRoaXMtPnZhcnNbJ2VuZHBvaW50cydd
KS4iJyx0eXBlID0gJzEnLGV2ZW50ID0gJ3dsa19waHNiJyxodG1sID0gJ3dsa19waHNiX3Rl
eHRhcmVhJyxwb3NpdGlvbiA9ICc2MCcsdXNlcl9uYW1lID0gJyciKTsKCX0KCglmdW5jdGlv
biBkZWxldGUoKSB7CgkJc2FmZV9kZWxldGUoJ3R4cF9wcmVmcycsIm5hbWUgTElLRSAnd2xr
X3Boc2JfJSciKTsKCX0KfQoKLy8gYSBQSFAgY2xpZW50IGxpYnJhcnkgZm9yIHB1YnN1Ymh1
YmJ1YgovLyBhcyBkZWZpbmVkIGF0IGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9wdWJzdWJo
dWJidWIvCi8vIHdyaXR0ZW4gYnkgSm9zaCBGcmFzZXIgfCBqb3NoZnJhc2VyLmNvbSB8IGpv
c2hAZXZlbnR2dWUuY29tCi8vIFJlbGVhc2VkIHVuZGVyIEFwYWNoZSBMaWNlbnNlIDIuMApj
bGFzcyBQdWJsaXNoZXIgewoJdmFyICRodWJfdXJsOwoJdmFyICRsYXN0X3Jlc3BvbnNlOwoJ
dmFyICR1c2VyX2FnZW50ID0gIlB1YlN1Ykh1YmJ1Yi1QdWJsaXNoZXItUEhQLzEuMCI7CgoJ
Ly8gY3JlYXRlIGEgbmV3IFB1Ymxpc2hlcgoJZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGh1Yl91
cmwsICR1YT1udWxsKSB7CgoJCWlmICghaXNzZXQoJGh1Yl91cmwpKQoJCQlyZXR1cm4gZmFs
c2U7CgkJCS8vIHRocm93IG5ldyBFeGNlcHRpb24oJ1BsZWFzZSBzcGVjaWZ5IGEgaHViIHVy
bCcpOwoKCQlpZiAoIXByZWdfbWF0Y2goInxeaHR0cHM/Oi8vfGkiLCRodWJfdXJsKSkKCQkJ
cmV0dXJuIGZhbHNlOwoJCQkvLyB0aHJvdyBuZXcgRXhjZXB0aW9uKCdUaGUgc3BlY2lmaWVk
IGh1YiB1cmwgZG9lcyBub3QgYXBwZWFyIHRvIGJlIHZhbGlkOiAnLiRodWJfdXJsKTsKCgkJ
JHRoaXMtPmh1Yl91cmwgPSAkaHViX3VybDsKCQlpZigkdWEpIHsKCQkJJHRoaXMtPnVzZXJf
YWdlbnQgPSAkdWE7CgkJfQoJfQoKCWZ1bmN0aW9uIFB1Ymxpc2hlcigkaHViX3VybCwgJHVh
PW51bGwpIHsKCQkkdGhpcy0+X19jb25zdHJ1Y3QoJGh1Yl91cmwsICR1YSk7Cgl9CgoJLy8g
YWNjZXB0cyBlaXRoZXIgYSBzaW5nbGUgdXJsIG9yIGFuIGFycmF5IG9mIHVybHMKCWZ1bmN0
aW9uIHB1Ymxpc2hfdXBkYXRlKCR0b3BpY191cmxzLCAkaHR0cF9mdW5jdGlvbiA9IGZhbHNl
KSB7CgkJaWYgKCFpc3NldCgkdG9waWNfdXJscykpCgkJCXJldHVybiBmYWxzZTsKCQkJLy8g
dGhyb3cgbmV3IEV4Y2VwdGlvbignUGxlYXNlIHNwZWNpZnkgYSB0b3BpYyB1cmwnKTsKCgkJ
Ly8gY2hlY2sgdGhhdCB3ZSdyZSB3b3JraW5nIHdpdGggYW4gYXJyYXkKCQlpZiAoIWlzX2Fy
cmF5KCR0b3BpY191cmxzKSkgewoJCQkkdG9waWNfdXJscyA9IGFycmF5KCR0b3BpY191cmxz
KTsKCQl9CgoJCS8vIHNldCB0aGUgbW9kZSB0byBwdWJsaXNoCgkJJHBvc3Rfc3RyaW5nID0g
Imh1Yi5tb2RlPXB1Ymxpc2giOwoJCS8vIGxvb3AgdGhyb3VnaCBlYWNoIHRvcGljIHVybAoJ
CWZvcmVhY2ggKCR0b3BpY191cmxzIGFzICR0b3BpY191cmwpIHsKCgkJCS8vIGxpZ2h0d2Vp
Z2h0IGNoZWNrIHRoYXQgd2UncmUgYWN0dWFsbHkgd29ya2luZyB3LyBhIHZhbGlkIHVybAoJ
CQlpZiAoIXByZWdfbWF0Y2goInxeaHR0cHM/Oi8vfGkiLCR0b3BpY191cmwpKQoJCQkJcmV0
dXJuIGZhbHNlOwoJCQkJLy8gdGhyb3cgbmV3IEV4Y2VwdGlvbignVGhlIHNwZWNpZmllZCB0
b3BpYyB1cmwgZG9lcyBub3QgYXBwZWFyIHRvIGJlIHZhbGlkOiAnLiR0b3BpY191cmwpOwoK
CQkJLy8gYXBwZW5kIHRoZSB0b3BpYyB1cmwgcGFyYW1ldGVycwoJCQkkcG9zdF9zdHJpbmcg
Lj0gIiZodWIudXJsPSIudXJsZW5jb2RlKCR0b3BpY191cmwpOwoJCX0KCgkJLy8gbWFrZSB0
aGUgaHR0cCBwb3N0IHJlcXVlc3QgYW5kIHJldHVybiB0cnVlL2ZhbHNlCgkJLy8gZWFzeSB0
byBvdmVyLXdyaXRlIHRvIHVzZSB5b3VyIG93biBodHRwIGZ1bmN0aW9uCgkJaWYgKCRodHRw
X2Z1bmN0aW9uKQoJCQlyZXR1cm4gJGh0dHBfZnVuY3Rpb24oJHRoaXMtPmh1Yl91cmwsJHBv
c3Rfc3RyaW5nKTsKCQllbHNlCgkJCXJldHVybiAkdGhpcy0+aHR0cF9wb3N0KCR0aGlzLT5o
dWJfdXJsLCRwb3N0X3N0cmluZyk7Cgl9CgoJLy8gcmV0dXJucyBhbnkgZXJyb3IgbWVzc2Fn
ZSBmcm9tIHRoZSBsYXRlc3QgcmVxdWVzdAoJZnVuY3Rpb24gbGFzdF9yZXNwb25zZSgpIHsK
CQlyZXR1cm4gJHRoaXMtPmxhc3RfcmVzcG9uc2U7Cgl9CgoJLy8gZGVmYXVsdCBodHRwIGZ1
bmN0aW9uIHRoYXQgdXNlcyBjdXJsIHRvIHBvc3QgdG8gdGhlIGh1YiBlbmRwb2ludAoJZnVu
Y3Rpb24gaHR0cF9wb3N0KCR1cmwsICRwb3N0X3N0cmluZykgewoKCQkvLyBhZGQgYW55IGFk
ZGl0aW9uYWwgY3VybCBvcHRpb25zIGhlcmUKCQkkb3B0aW9ucyA9IGFycmF5KENVUkxPUFRf
VVJMID0+ICR1cmwsCgkJQ1VSTE9QVF9QT1NUID0+IHRydWUsCgkJQ1VSTE9QVF9QT1NURklF
TERTID0+ICRwb3N0X3N0cmluZywKCQlDVVJMT1BUX1VTRVJBR0VOVCA9PiAkdGhpcy0+dXNl
cl9hZ2VudCk7CgoJCSRjaCA9IGN1cmxfaW5pdCgpOwoJCWN1cmxfc2V0b3B0X2FycmF5KCRj
aCwgJG9wdGlvbnMpOwoKCQkkcmVzcG9uc2UgPSBjdXJsX2V4ZWMoJGNoKTsKCQkkdGhpcy0+
bGFzdF9yZXNwb25zZSA9ICRyZXNwb25zZTsKCQkkaW5mbyA9IGN1cmxfZ2V0aW5mbygkY2gp
OwoKCQljdXJsX2Nsb3NlKCRjaCk7CgoJCS8vIGFsbCBnb29kCgkJaWYgKCRpbmZvWydodHRw
X2NvZGUnXSA9PSAyMDQpCgkJCXJldHVybiB0cnVlOwoJCXJldHVybiBmYWxzZTsKCX0KfQoi
O3M6MzoibWQ1IjtzOjMyOiJiZjUwNDFlMGRiMGI0YzgwNjIwOGVmNGZlMzQ4ZGQyZCI7fQ==