# wlk_phsb v1.0
# A pubsubhubbub plugin to enable the pushbutton web.
# Walker Hamilton
# http://walkerhamilton.com

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMDp7czo3OiJ2ZXJzaW9uIjtzOjM6IjEuMCI7czo2OiJhdXRob3IiO3M6MTU6IldhbGtl
ciBIYW1pbHRvbiI7czoxMDoiYXV0aG9yX3VyaSI7czoyNToiaHR0cDovL3dhbGtlcmhhbWls
dG9uLmNvbSI7czoxMToiZGVzY3JpcHRpb24iO3M6NTE6IkEgcHVic3ViaHViYnViIHBsdWdp
biB0byBlbmFibGUgdGhlIHB1c2hidXR0b24gd2ViLiI7czo0OiJ0eXBlIjtpOjE7czo1OiJm
bGFncyI7aToyO3M6NDoibmFtZSI7czo4OiJ3bGtfcGhzYiI7czo0OiJoZWxwIjtzOjUwNDoi
CTxoMj5BYm91dDwvaDI+CgoJPHA+VGhpcyBwbHVnaW4gZW5hYmxlcyA8YSBocmVmPSJodHRw
Oi8vY29kZS5nb29nbGUuY29tL3AvcHVic3ViaHViYnViIj5wdWJzdWJodWJidWI8L2E+IHN1
cHBvcnQgZm9yIGJ1aWx0LWluIHRleHRwYXR0ZXJuIGZlZWRzLiAoUmVxdWlyZXMgPHNwYW4g
Y2xhc3M9ImNhcHMiPkNVUkw8L3NwYW4+KTwvcD4KCgk8aDI+SW5zdGFsbGF0aW9uIGFuZCBV
c2U8L2gyPgoKCTxwPklmIHlvdSYjODIxNzt2ZSBpbnN0YWxsZWQgYW5kIGFjdGl2YXRlZCBp
dCwgeW91JiM4MjE3O3JlIHJlYWR5IHRvIGdvLjwvcD4KCgk8aDI+VGhhbmtzPC9oMj4KCgk8
cD5UaGUgcHVibGlzaGVyIGNsYXNzIHdhcyB3cml0dGVuIGJ5IEpvc2ggRnJhemVyIChqb3No
ZnJhc2VyLmNvbSkgYmVmb3JlIGJlaW5nIG1vZGlmaWVkIHNsaWdodGx5IGZvciB1c2UgaGVy
ZS4gSm9zaCBhbHNvIHdyb3RlIHRoZSBXb3JkcHJlc3MgcGx1Z2luIHRoYXQgSSBiYXNlZCB0
aGlzIHBsdWdpbiBvbi48L3A+IjtzOjQ6ImNvZGUiO3M6MTEyNTQ6IgpyZWdpc3Rlcl9jYWxs
YmFjaygnd2xrX3Boc2JfcnNzX2hlYWQnLCAncnNzX2hlYWQnKTsKcmVnaXN0ZXJfY2FsbGJh
Y2soJ3dsa19waHNiX2F0b21faGVhZCcsICdhdG9tX2hlYWQnKTsKCmlmKEB0eHBpbnRlcmZh
Y2UgPT0gJ2FkbWluJykKewoJcmVnaXN0ZXJfY2FsbGJhY2soJ3dsa19waHNiX2luc3RhbGwn
LCAncGx1Z2luX2xpZmVjeWNsZS53bGtfcGhzYicsICdpbnN0YWxsZWQnKTsKCXJlZ2lzdGVy
X2NhbGxiYWNrKCd3bGtfcGhzYl9kZWxldGUnLCAncGx1Z2luX2xpZmVjeWNsZS53bGtfcGhz
YicsICdkZWxldGVkJyk7CglyZWdpc3Rlcl9jYWxsYmFjaygnd2xrX3Boc2JfbGFuZ3VhZ2Un
LCAnYWRtaW5fc2lkZScsICdwYWdldG9wJyk7CglyZWdpc3Rlcl9jYWxsYmFjaygnd2xrX3Bo
c2Jfc2NoZWR1bGUnLCAnYXJ0aWNsZScsICdlZGl0Jyk7Cn0KCmZ1bmN0aW9uIHdsa19waHNi
X3NjaGVkdWxlKCkgewoJJHBjID0gbmV3IFdsa1Boc2JDbGFzcygpOwoJJHBjLT5zY2hlZHVs
ZV9wb3N0X25vdGlmaWNhdGlvbnMoKTsKfQoKZnVuY3Rpb24gd2xrX3Boc2JfcnNzX2hlYWQo
KSB7CgkkcGMgPSBuZXcgV2xrUGhzYkNsYXNzKCk7CglyZXR1cm4gJHBjLT5yc3NfaGVhZCgp
Owp9CgpmdW5jdGlvbiB3bGtfcGhzYl9hdG9tX2hlYWQoKSB7CgkkcGMgPSBuZXcgV2xrUGhz
YkNsYXNzKCk7CglyZXR1cm4gJHBjLT5hdG9tX2hlYWQoKTsKfQoKZnVuY3Rpb24gd2xrX3Bo
c2JfaW5zdGFsbCgpIHsKCSRwYyA9IG5ldyBXbGtQaHNiQ2xhc3MoKTsKCSRwYy0+aW5zdGFs
bCgpOwp9CgpmdW5jdGlvbiB3bGtfcGhzYl9kZWxldGUoKSB7CgkkcGMgPSBuZXcgV2xrUGhz
YkNsYXNzKCk7CgkkcGMtPmRlbGV0ZSgpOwp9CgpmdW5jdGlvbiB3bGtfcGhzYl9sYW5ndWFn
ZSgpIHsKCSRwYyA9IG5ldyBXbGtQaHNiQ2xhc3MoKTsKfQoKZnVuY3Rpb24gd2xrX3Boc2Jf
dGV4dGFyZWEoKSB7CgkkcGMgPSBuZXcgV2xrUGhzYkNsYXNzKCk7CglyZXR1cm4gJHBjLT5l
bmRwb2ludHNfdGV4dGFyZWEoKTsKfQoKLy8KY2xhc3MgV2xrUGhzYkNsYXNzIHsKCXZhciAk
dmFycyA9IGFycmF5KAoJCSdub3RpZmljYXRpb25zX2luc3RhbnQnID0+IHRydWUsCgkJJ3Vz
ZXJfYWdlbnQnID0+ICdUZXh0cGF0dGVybi9QSFNCIDAuMicsCgkJJ21heF9mYWlsdXJlcycg
PT4gNSwKCQkndGltZW91dCcgPT4gMywKCQknZW5kcG9pbnRzJyA9PiBhcnJheSgiaHR0cDov
L3B1YnN1Ymh1YmJ1Yi5hcHBzcG90LmNvbSIsICJodHRwOi8vc3VwZXJmZWVkci5jb20vaHVi
YnViIikKCSk7CgoJZnVuY3Rpb24gX19jb25zdHJ1Y3QoKSB7CgkJZ2xvYmFsICRwcmVmcywg
JHRleHRhcnJheTsKCgkJaWYoJHByZWZzWydsYW5ndWFnZSddPT0nZW4tdXMnKSB7CgkJCSR0
ZXh0YXJyYXlbJ3dsa19waHNiJ10gPSAnUHViU3ViSHViQnViJzsKCQkJJHRleHRhcnJheVsn
cnNzY2xvdWRfc3RhbmRhcmQnXSA9ICdTdGFuZGFyZCBmZWVkcyc7CgkJCSR0ZXh0YXJyYXlb
J3Jzc2Nsb3VkX2JvdGgnXSA9ICdCb3RoIHN0YW5kYXJkIGZlZWRzICYgdGhlIGN1c3RvbSBm
ZWVkJzsKCQkJJHRleHRhcnJheVsncnNzY2xvdWRfY3VzdG9tX29ubHknXSA9ICdDdXN0b20g
ZmVlZCBvbmx5JzsKCQkJJHRleHRhcnJheVsnd2xrX3Boc2Jfbm90aWZpY2F0aW9uc19pbnN0
YW50J10gPSAnSW5zdGFudCBub3RpZmljYXRpb25zPyAoIk5vIiByZXF1aXJlcyB3bGtfY3Jv
biknOwoJCQkkdGV4dGFycmF5Wyd3bGtfcGhzYl9lbmRwb2ludHMnXSA9ICdQSFNCIFNlcnZl
cnMgKHNlcGFyYXRlIGxpbmVzKSc7CgkJfQoKCQlpZihpc3NldCgkcHJlZnNbJ3dsa19waHNi
X25vdGlmaWNhdGlvbnNfaW5zdGFudCddKSAmJiAhZW1wdHkoJHByZWZzWyd3bGtfcGhzYl9u
b3RpZmljYXRpb25zX2luc3RhbnQnXSkpIHsgJHRoaXMtPnZhcnNbJ25vdGlmaWNhdGlvbnNf
aW5zdGFudCddID0gKGJvb2wpJHByZWZzWyd3bGtfcGhzYl9ub3RpZmljYXRpb25zX2luc3Rh
bnQnXTsgfQoJCWlmKGlzc2V0KCRwcmVmc1snd2xrX3Boc2JfbWF4X2ZhaWx1cmVzJ10pICYm
ICFlbXB0eSgkcHJlZnNbJ3dsa19waHNiX21heF9mYWlsdXJlcyddKSkgeyAkdGhpcy0+dmFy
c1snbWF4X2ZhaWx1cmVzJ10gPSAoaW50KSRwcmVmc1snd2xrX3Boc2JfbWF4X2ZhaWx1cmVz
J107IH0KCQlpZihpc3NldCgkcHJlZnNbJ3dsa19waHNiX3RpbWVvdXQnXSkgJiYgIWVtcHR5
KCRwcmVmc1snd2xrX3Boc2JfdGltZW91dCddKSkgeyAkdGhpcy0+dmFyc1sndGltZW91dCdd
ID0gKGludCkkcHJlZnNbJ3dsa19waHNiX3RpbWVvdXQnXTsgfQoJCWlmKGlzc2V0KCRwcmVm
c1snd2xrX3Boc2JfdXNlcl9hZ2VudCddKSAmJiAhZW1wdHkoJHByZWZzWyd3bGtfcGhzYl91
c2VyX2FnZW50J10pKSB7ICR0aGlzLT52YXJzWyd1c2VyX2FnZW50J10gPSAkcHJlZnNbJ3ds
a19waHNiX3VzZXJfYWdlbnQnXTsgfQoJCWlmKGlzc2V0KCRwcmVmc1snd2xrX3Boc2JfZW5k
cG9pbnRzJ10pICYmICFlbXB0eSgkcHJlZnNbJ3dsa19waHNiX2VuZHBvaW50cyddKSkgewoJ
CQkkdGhpcy0+dmFyc1snZW5kcG9pbnRzJ10gPSBleHBsb2RlKCJcbiIsICRwcmVmc1snd2xr
X3Boc2JfZW5kcG9pbnRzJ10pOwoJCQkvLyBjbGVhbiBvdXQgYW55IGJsYW5rIHZhbHVlcwoJ
CQlmb3JlYWNoICgkdGhpcy0+dmFyc1snZW5kcG9pbnRzJ10gYXMgJGtleSA9PiAkdmFsdWUp
IHsKCQkJCWlmIChpc19udWxsKCR2YWx1ZSkgfHwgJHZhbHVlPT0iIikgewoJCQkJCXVuc2V0
KCR0aGlzLT52YXJzWydlbmRwb2ludHMnXVska2V5XSk7CgkJCQl9IGVsc2UgewoJCQkJCSR0
aGlzLT52YXJzWydlbmRwb2ludHMnXVska2V5XSA9IHRyaW0oJHRoaXMtPnZhcnNbJ2VuZHBv
aW50cyddWyRrZXldKTsKCQkJCX0KCQkJfQoJCQkkdGhpcy0+dmFyc1snZW5kcG9pbnRzJ10g
PSBhcnJheV9tZXJnZSgkdGhpcy0+dmFyc1snZW5kcG9pbnRzJ10pOwoJCX0KCX0KCglmdW5j
dGlvbiBXbGtQaHNiQ2xhc3MoKSB7CgkJJHRoaXMtPl9fY29uc3RydWN0KCk7Cgl9CgoJZnVu
Y3Rpb24gYXRvbV9oZWFkKCkgewoJCSRodWJfdXJscyA9ICR0aGlzLT5nZXRfcHVic3ViX2Vu
ZHBvaW50cygpOwoJCSRmaW5hbCA9ICcnOwoJCWZvcmVhY2ggKCRodWJfdXJscyBhcyAkaHVi
X3VybCkgewoJCQkkZmluYWwgLj0gJzxsaW5rIHJlbD0iaHViIiBocmVmPSInLiRodWJfdXJs
LiciIC8+Jy4iXHJcbiI7CgkJfQoJCXJldHVybiAkZmluYWw7Cgl9CgoJZnVuY3Rpb24gcnNz
X2hlYWQoKSB7CgkJJGh1Yl91cmxzID0gJHRoaXMtPmdldF9wdWJzdWJfZW5kcG9pbnRzKCk7
CgkJJGZpbmFsID0gJyc7CgkJZm9yZWFjaCAoJGh1Yl91cmxzIGFzICRodWJfdXJsKSB7CgkJ
CSRmaW5hbCAuPSAnPGF0b206bGluayByZWw9Imh1YiIgaHJlZj0iJy4kaHViX3VybC4nIi8+
Jy4iXHJcbiI7CgkJfQoJCXJldHVybiAkZmluYWw7Cgl9CgoJZnVuY3Rpb24gc2NoZWR1bGVf
cG9zdF9ub3RpZmljYXRpb25zKCkgewoJCWlmKCR0aGlzLT52YXJzWydub3RpZmljYXRpb25z
X2luc3RhbnQnXSAmJiBmdW5jdGlvbl9leGlzdHMoJ3dsa19jcm9uX3NpbmdsZV9ldmVudCcp
KSB7CgkJCS8vIFRPRE86IGNyZWF0ZSB3bGtfY3JvbiBQbHVnaW4KCQkJd2xrX2Nyb25fc2lu
Z2xlX2V2ZW50KHRpbWUoKSwgJ3NlbmRfcG9zdF9ub3RpZmljYXRpb25zX2FjdGlvbicpOwoJ
CX0gZWxzZSB7CgkJCSR0aGlzLT5zZW5kX3Bvc3Rfbm90aWZpY2F0aW9ucygpOwoJCX0KCX0K
CglmdW5jdGlvbiBzZW5kX3Bvc3Rfbm90aWZpY2F0aW9ucygpIHsKCQlnbG9iYWwgJHByZWZz
OwoJCSRzZW5kX3VkID0gZmFsc2U7CgkJaWYoIWVtcHR5KCRfUE9TVCkgJiYgaXNzZXQoJF9Q
T1NUWydJRCddKSkgewoJCQlpZihpc19udW1lcmljKCRfUE9TVFsnSUQnXSkpIHsKCQkJCSRh
ID0gc2FmZV9yb3coJ1N0YXR1cycsICd0ZXh0cGF0dGVybicsICdJRD0nLmludHZhbCgkX1BP
U1RbJ2lkJ10pKTsKCQkJCWlmICgkYSkgewoJCQkJCWlmKCR1RXhwaXJlcyBhbmQgdGltZSgp
ID4gJHVFeHBpcmVzIGFuZCAhJHByZWZzWydwdWJsaXNoX2V4cGlyZWRfYXJ0aWNsZXMnXSkg
ewoJCQkJCQkkc2VuZF91ZCA9IGZhbHNlOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJCWlm
KCgkYVsnU3RhdHVzJ10hPTQgfHwgJGFbJ1N0YXR1cyddIT01KSAmJiAoJF9QT1NUWydTdGF0
dXMnXT09NCB8fCAkX1BPU1RbJ1N0YXR1cyddPT01KSkgewoJCQkJCQkvLyBzdGF0dXMgY2hh
bmdlZCB0byBwdWJsaXNoZWQKCQkJCQkJJHNlbmRfdWQgPSB0cnVlOwoJCQkJCX0gZWxzZSB7
CgkJCQkJCS8vIHN0YXR1cyBkaWRuJ3QgY2hhbmdlIHRvIHB1Ymxpc2hlZAoJCQkJCQkkc2Vu
ZF91ZCA9IGZhbHNlOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQkk
c2VuZF91ZCA9IGZhbHNlOwoJCQkJfQoJCQl9IGVsc2UgaWYoKCFpc19udW1lcmljKCRfUE9T
VFsnSUQnXSkgfHwgZW1wdHkoJF9QT1NUWydJRCddKSkgJiYgKCRfUE9TVFsnU3RhdHVzJ109
PTQgfHwgJF9QT1NUWydTdGF0dXMnXT09NSkpIHsKCQkJCWlmKCEkdGhpcy0+ZXhwaXJlZCgk
X1BPU1QpICYmICR0aGlzLT5wdWJsaXNoZWQoJF9QT1NUKSkgewoJCQkJCSRzZW5kX3VkID0g
dHJ1ZTsKCQkJCX0gZWxzZSBpZighJHRoaXMtPmV4cGlyZWQoJF9QT1NUKSAmJiAhJHRoaXMt
PnB1Ymxpc2hlZCgkX1BPU1QpKSB7CgkJCQkJLy8gVE9ETzogU2V0IGNyb24KCQkJCQkkc2Vu
ZF91ZCA9IGZhbHNlOwoJCQkJCXJldHVybjsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIGVy
cm9yIQoJCQkJJHNlbmRfdWQgPSBmYWxzZTsKCQkJCXJldHVybjsKCQkJfQoJCX0KCgkJaWYo
JHNlbmRfdWQpIHsKCQkJJHVybHMgPSBhcnJheSgpOwoKCQkJaWYoJHByZWZzWyd3bGtfcGhz
Yl9mZWVkcyddPT0nY3VzdG9tX29ubHknIHx8ICRwcmVmc1snd2xrX3Boc2JfZmVlZHMnXT09
J2JvdGgnKSB7CgkJCQkkdXJsc1tdID0gJHByZWZzWydjdXN0b21fdXJsJ107CgkJCX0KCgkJ
CWlmKCRwcmVmc1snd2xrX3Boc2JfZmVlZHMnXT09J2JvdGgnIHx8ICRwcmVmc1snd2xrX3Bo
c2JfZmVlZHMnXT09J3N0YW5kYXJkJykgewoJCQkJLy8gZ2V0IHRoZSBzZWN0aW9uLCBjYXRl
Z29yeSwgJiAiQWxsIgoJCQkJJGZycyA9IHNhZmVfY29sdW1uKCJuYW1lIiwgInR4cF9zZWN0
aW9uIiwgImluX3JzcyAhPSAnMSciKTsKCQkJCWlmKGlzc2V0KCRfUE9TVFsnU2VjdGlvbidd
KSAmJiBpbl9hcnJheSgkX1BPU1RbJ1NlY3Rpb24nXSwgJGZycykpIHsKCQkJCQkvLyBjYW4n
dCBzZW5kIHRoYXQgc2VjdGlvbgoJCQkJfSBlbHNlIHsKCQkJCQkvLyBjb25zdHJ1Y3QgdGhl
IGZlZWQgVVJMcwoJCQkJCS8vIGFkZCB0byB0aGUgVVJMcyBhcnJheQoJCQkJCSR1cmxzW10g
PSBodS4ncnNzLyc7CgoJCQkJCWlmKGlzc2V0KCRfUE9TVFsnU2VjdGlvbiddKSAmJiAhZW1w
dHkoJF9QT1NUWydTZWN0aW9uJ10pKSB7CgkJCQkJCSR1cmxzW10gPSBodS4ncnNzLz9zZWN0
aW9uPScuJF9QT1NUWydTZWN0aW9uJ107CgkJCQkJfQoKCQkJCQlpZihpc3NldCgkX1BPU1Rb
J0NhdGVnb3J5MSddKSAmJiAhZW1wdHkoJF9QT1NUWydDYXRlZ29yeTEnXSkpIHsKCQkJCQkJ
JHVybHNbXSA9IGh1Lidyc3MvP2NhdGVnb3J5PScuJF9QT1NUWydDYXRlZ29yeTEnXTsKCQkJ
CQkJaWYoaXNzZXQoJF9QT1NUWydTZWN0aW9uJ10pICYmICFlbXB0eSgkX1BPU1RbJ1NlY3Rp
b24nXSkpIHsKCQkJCQkJCSR1cmxzW10gPSBodS4ncnNzLz9zZWN0aW9uPScuJF9QT1NUWydT
ZWN0aW9uJ10uJyZjYXRlZ29yeT0nLiRfUE9TVFsnQ2F0ZWdvcnkxJ107CgkJCQkJCX0KCQkJ
CQl9CgoJCQkJCWlmKGlzc2V0KCRfUE9TVFsnQ2F0ZWdvcnkyJ10pICYmICFlbXB0eSgkX1BP
U1RbJ0NhdGVnb3J5MiddKSkgewoJCQkJCQkkdXJsc1tdID0gaHUuJ3Jzcy8/Y2F0ZWdvcnk9
Jy4kX1BPU1RbJ0NhdGVnb3J5MiddOwoJCQkJCQlpZihpc3NldCgkX1BPU1RbJ1NlY3Rpb24n
XSkgJiYgIWVtcHR5KCRfUE9TVFsnU2VjdGlvbiddKSkgewoJCQkJCQkJJHVybHNbXSA9IGh1
Lidyc3MvP3NlY3Rpb249Jy4kX1BPU1RbJ1NlY3Rpb24nXS4nJmNhdGVnb3J5PScuJF9QT1NU
WydDYXRlZ29yeTInXTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJaWYoIWVtcHR5
KCR1cmxzKSkKCQkJewoJCQkJJGZlZWRfdXJscyA9IGFycmF5X3VuaXF1ZSgkdXJscyk7CgkJ
CQkvLyBnZXQgdGhlIGxpc3Qgb2YgaHVicwoJCQkJJGh1Yl91cmxzID0gJHRoaXMtPmdldF9w
dWJzdWJfZW5kcG9pbnRzKCk7CgkJCQkvLyBsb29wIHRocm91Z2ggZWFjaCBodWIKCQkJCWZv
cmVhY2ggKCRodWJfdXJscyBhcyAkaHViX3VybCkKCQkJCXsKCQkJCQkkcCA9IG5ldyBQdWJs
aXNoZXIoJGh1Yl91cmwsICR0aGlzLT52YXJzWyd1c2VyX2FnZW50J10pOwoJCQkJCS8vIHB1
Ymxpc2ggdGhlIHVwZGF0ZSB0byBlYWNoIGh1YgoJCQkJCWlmICghJHAtPnB1Ymxpc2hfdXBk
YXRlKCRmZWVkX3VybHMpKQoJCQkJCXsKCQkJCQkJLy8gVE9ETzogYWRkIGJldHRlciBlcnJv
ciBoYW5kbGluZyBoZXJlCgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQoKCWZ1bmN0aW9uIHB1
Ymxpc2hlZCgkcG9zdCkgewoJCSR3aGVuX3RzID0gdGltZSgpOwoKCQlpZihpc3NldCgkcG9z
dFsncmVzZXRfdGltZSddKSkgewoJCQlyZXR1cm4gdHJ1ZTsKCQl9IGVsc2UgewoJCQlpZiAo
IWlzX251bWVyaWMoJHBvc3RbJ3llYXInXSkgfHwgIWlzX251bWVyaWMoJHBvc3RbJ21vbnRo
J10pIHx8ICFpc19udW1lcmljKCRwb3N0WydkYXknXSkgfHwgIWlzX251bWVyaWMoJHBvc3Rb
J2hvdXInXSkgIHx8ICFpc19udW1lcmljKCRwb3N0WydtaW51dGUnXSkgfHwgIWlzX251bWVy
aWMoJHBvc3RbJ3NlY29uZCddKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQkkdHMg
PSBzdHJ0b3RpbWUoJHBvc3RbJ3llYXInXS4nLScuJHBvc3RbJ21vbnRoJ10uJy0nLiRwb3N0
WydkYXknXS4nICcuJHBvc3RbJ2hvdXInXS4nOicuJHBvc3RbJ21pbnV0ZSddLic6Jy4kcG9z
dFsnc2Vjb25kJ10pOwoJCQlpZiAoJHRzID09PSBmYWxzZSB8fCAkdHMgPT09IC0xKSB7CgkJ
CQlyZXR1cm4gZmFsc2U7CgkJCX0KCgkJCSR3aGVuID0gJHdoZW5fdHMgPSAkdHMgLSB0el9v
ZmZzZXQoJHRzKTsKCgkJCWlmKCR3aGVuPD10aW1lKCkpCgkJCQlyZXR1cm4gdHJ1ZTsKCQkJ
ZWxzZQoJCQkJcmV0dXJuIGZhbHNlOwoJCX0KCX0KCglmdW5jdGlvbiBleHBpcmVkKCRwb3N0
KSB7CgkJaWYoaXNzZXQoJHBvc3RbJ2V4cF95ZWFyJ10pICYmICFlbXB0eSgkcG9zdFsnZXhw
X3llYXInXSkpIHsKCQkJaWYoZW1wdHkoJHBvc3RbJ2V4cF9tb250aCddKSkgJHBvc3RbJ2V4
cF9tb250aCddPTE7CgkJCWlmKGVtcHR5KCRwb3N0WydleHBfZGF5J10pKSAkcG9zdFsnZXhw
X2RheSddPTE7CgkJCWlmKGVtcHR5KCRwb3N0WydleHBfaG91ciddKSkgJHBvc3RbJ2V4cF9o
b3VyJ109MDsKCQkJaWYoZW1wdHkoJHBvc3RbJ2V4cF9taW51dGUnXSkpICRwb3N0WydleHBf
bWludXRlJ109MDsKCQkJaWYoZW1wdHkoJHBvc3RbJ2V4cF9zZWNvbmQnXSkpICRwb3N0Wydl
eHBfc2Vjb25kJ109MDsKCgkJCSR0cyA9IHN0cnRvdGltZSgkcG9zdFsnZXhwX3llYXInXS4n
LScuJHBvc3RbJ2V4cF9tb250aCddLictJy4kcG9zdFsnZXhwX2RheSddLicgJy4kcG9zdFsn
ZXhwX2hvdXInXS4nOicuJHBvc3RbJ2V4cF9taW51dGUnXS4nOicuJHBvc3RbJ2V4cF9zZWNv
bmQnXSk7CgkJCSRleHBpcmVzID0gJHRzIC0gdHpfb2Zmc2V0KCR0cyk7CgoJCQlpZigkZXhw
aXJlczw9dGltZSgpKQoJCQkJcmV0dXJuIHRydWU7CgkJCWVsc2UKCQkJCXJldHVybiBmYWxz
ZTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoKCS8vIGdldCB0aGUgZW5k
cG9pbnRzIGZyb20gdGhlIHdvcmRwcmVzcyBvcHRpb25zIHRhYmxlCgkvLyB2YWxpZCBwYXJh
bWV0ZXJzIGFyZSAicHVibGlzaCIgb3IgInN1YnNjcmliZSIKCWZ1bmN0aW9uIGdldF9wdWJz
dWJfZW5kcG9pbnRzKCkgewoJCXJldHVybiAkdGhpcy0+dmFyc1snZW5kcG9pbnRzJ107Cgl9
CgoJZnVuY3Rpb24gZW5kcG9pbnRzX3RleHRhcmVhKCkgewoJCXJldHVybiAnPHRleHRhcmVh
IG5hbWU9Indsa19waHNiX2VuZHBvaW50cyIgY29scz0iNTUiIHJvd3M9IjQiPicuaHRtbHNw
ZWNpYWxjaGFycyhpbXBsb2RlKCJcbiIsICR0aGlzLT52YXJzWydlbmRwb2ludHMnXSkpLic8
L3RleHRhcmVhPic7Cgl9CgoJLyogSW5zdGFsbCBHb2VzIEhlcmUgKi8KCWZ1bmN0aW9uIGlu
c3RhbGwoKSB7CgkJc2FmZV9xdWVyeSgnREVMRVRFIEZST00gJy5zYWZlX3BmeCgndHhwX3By
ZWZzJykuJyBXSEVSRSBuYW1lIExJS0UgIndsa19waHNiXyUiJyk7CgkJc2FmZV9pbnNlcnQo
J3R4cF9wcmVmcycsInByZWZzX2lkID0gJzEnLG5hbWUgPSAnd2xrX3Boc2Jfbm90aWZpY2F0
aW9uc19pbnN0YW50Jyx2YWwgPSAnMScsdHlwZSA9ICcxJyxldmVudCA9ICd3bGtfcGhzYics
aHRtbCA9ICd5ZXNub3JhZGlvJyxwb3NpdGlvbiA9ICcxMCcsdXNlcl9uYW1lID0gJyciKTsK
CQlzYWZlX2luc2VydCgndHhwX3ByZWZzJywicHJlZnNfaWQgPSAnMScsbmFtZSA9ICd3bGtf
cGhzYl9lbmRwb2ludHMnLHZhbCA9ICciLmltcGxvZGUoIlxuIiwgJHRoaXMtPnZhcnNbJ2Vu
ZHBvaW50cyddKS4iJyx0eXBlID0gJzEnLGV2ZW50ID0gJ3dsa19waHNiJyxodG1sID0gJ3ds
a19waHNiX3RleHRhcmVhJyxwb3NpdGlvbiA9ICc2MCcsdXNlcl9uYW1lID0gJyciKTsKCX0K
CglmdW5jdGlvbiBkZWxldGUoKSB7CgkJc2FmZV9kZWxldGUoJ3R4cF9wcmVmcycsIm5hbWUg
TElLRSAnd2xrX3Boc2JfJSciKTsKCX0KfQoKLy8gYSBQSFAgY2xpZW50IGxpYnJhcnkgZm9y
IHB1YnN1Ymh1YmJ1YgovLyBhcyBkZWZpbmVkIGF0IGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20v
cC9wdWJzdWJodWJidWIvCi8vIHdyaXR0ZW4gYnkgSm9zaCBGcmFzZXIgfCBqb3NoZnJhc2Vy
LmNvbSB8IGpvc2hAZXZlbnR2dWUuY29tCi8vIFJlbGVhc2VkIHVuZGVyIEFwYWNoZSBMaWNl
bnNlIDIuMApjbGFzcyBQdWJsaXNoZXIgewoJdmFyICRodWJfdXJsOwoJdmFyICRsYXN0X3Jl
c3BvbnNlOwoJdmFyICR1c2VyX2FnZW50ID0gIlB1YlN1Ykh1YmJ1Yi1QdWJsaXNoZXItUEhQ
LzEuMCI7CgoJLy8gY3JlYXRlIGEgbmV3IFB1Ymxpc2hlcgoJZnVuY3Rpb24gX19jb25zdHJ1
Y3QoJGh1Yl91cmwsICR1YT1udWxsKSB7CgoJCWlmICghaXNzZXQoJGh1Yl91cmwpKQoJCQly
ZXR1cm4gZmFsc2U7CgkJCS8vIHRocm93IG5ldyBFeGNlcHRpb24oJ1BsZWFzZSBzcGVjaWZ5
IGEgaHViIHVybCcpOwoKCQlpZiAoIXByZWdfbWF0Y2goInxeaHR0cHM/Oi8vfGkiLCRodWJf
dXJsKSkKCQkJcmV0dXJuIGZhbHNlOwoJCQkvLyB0aHJvdyBuZXcgRXhjZXB0aW9uKCdUaGUg
c3BlY2lmaWVkIGh1YiB1cmwgZG9lcyBub3QgYXBwZWFyIHRvIGJlIHZhbGlkOiAnLiRodWJf
dXJsKTsKCgkJJHRoaXMtPmh1Yl91cmwgPSAkaHViX3VybDsKCQlpZigkdWEpIHsKCQkJJHRo
aXMtPnVzZXJfYWdlbnQgPSAkdWE7CgkJfQoJfQoKCWZ1bmN0aW9uIFB1Ymxpc2hlcigkaHVi
X3VybCwgJHVhPW51bGwpIHsKCQkkdGhpcy0+X19jb25zdHJ1Y3QoJGh1Yl91cmwsICR1YSk7
Cgl9CgoJLy8gYWNjZXB0cyBlaXRoZXIgYSBzaW5nbGUgdXJsIG9yIGFuIGFycmF5IG9mIHVy
bHMKCWZ1bmN0aW9uIHB1Ymxpc2hfdXBkYXRlKCR0b3BpY191cmxzLCAkaHR0cF9mdW5jdGlv
biA9IGZhbHNlKSB7CgkJaWYgKCFpc3NldCgkdG9waWNfdXJscykpCgkJCXJldHVybiBmYWxz
ZTsKCQkJLy8gdGhyb3cgbmV3IEV4Y2VwdGlvbignUGxlYXNlIHNwZWNpZnkgYSB0b3BpYyB1
cmwnKTsKCgkJLy8gY2hlY2sgdGhhdCB3ZSdyZSB3b3JraW5nIHdpdGggYW4gYXJyYXkKCQlp
ZiAoIWlzX2FycmF5KCR0b3BpY191cmxzKSkgewoJCQkkdG9waWNfdXJscyA9IGFycmF5KCR0
b3BpY191cmxzKTsKCQl9CgoJCS8vIHNldCB0aGUgbW9kZSB0byBwdWJsaXNoCgkJJHBvc3Rf
c3RyaW5nID0gImh1Yi5tb2RlPXB1Ymxpc2giOwoJCS8vIGxvb3AgdGhyb3VnaCBlYWNoIHRv
cGljIHVybAoJCWZvcmVhY2ggKCR0b3BpY191cmxzIGFzICR0b3BpY191cmwpIHsKCgkJCS8v
IGxpZ2h0d2VpZ2h0IGNoZWNrIHRoYXQgd2UncmUgYWN0dWFsbHkgd29ya2luZyB3LyBhIHZh
bGlkIHVybAoJCQlpZiAoIXByZWdfbWF0Y2goInxeaHR0cHM/Oi8vfGkiLCR0b3BpY191cmwp
KQoJCQkJcmV0dXJuIGZhbHNlOwoJCQkJLy8gdGhyb3cgbmV3IEV4Y2VwdGlvbignVGhlIHNw
ZWNpZmllZCB0b3BpYyB1cmwgZG9lcyBub3QgYXBwZWFyIHRvIGJlIHZhbGlkOiAnLiR0b3Bp
Y191cmwpOwoKCQkJLy8gYXBwZW5kIHRoZSB0b3BpYyB1cmwgcGFyYW1ldGVycwoJCQkkcG9z
dF9zdHJpbmcgLj0gIiZodWIudXJsPSIudXJsZW5jb2RlKCR0b3BpY191cmwpOwoJCX0KCgkJ
Ly8gbWFrZSB0aGUgaHR0cCBwb3N0IHJlcXVlc3QgYW5kIHJldHVybiB0cnVlL2ZhbHNlCgkJ
Ly8gZWFzeSB0byBvdmVyLXdyaXRlIHRvIHVzZSB5b3VyIG93biBodHRwIGZ1bmN0aW9uCgkJ
aWYgKCRodHRwX2Z1bmN0aW9uKQoJCQlyZXR1cm4gJGh0dHBfZnVuY3Rpb24oJHRoaXMtPmh1
Yl91cmwsJHBvc3Rfc3RyaW5nKTsKCQllbHNlCgkJCXJldHVybiAkdGhpcy0+aHR0cF9wb3N0
KCR0aGlzLT5odWJfdXJsLCRwb3N0X3N0cmluZyk7Cgl9CgoJLy8gcmV0dXJucyBhbnkgZXJy
b3IgbWVzc2FnZSBmcm9tIHRoZSBsYXRlc3QgcmVxdWVzdAoJZnVuY3Rpb24gbGFzdF9yZXNw
b25zZSgpIHsKCQlyZXR1cm4gJHRoaXMtPmxhc3RfcmVzcG9uc2U7Cgl9CgoJLy8gZGVmYXVs
dCBodHRwIGZ1bmN0aW9uIHRoYXQgdXNlcyBjdXJsIHRvIHBvc3QgdG8gdGhlIGh1YiBlbmRw
b2ludAoJZnVuY3Rpb24gaHR0cF9wb3N0KCR1cmwsICRwb3N0X3N0cmluZykgewoKCQkvLyBh
ZGQgYW55IGFkZGl0aW9uYWwgY3VybCBvcHRpb25zIGhlcmUKCQkkb3B0aW9ucyA9IGFycmF5
KENVUkxPUFRfVVJMID0+ICR1cmwsCgkJQ1VSTE9QVF9QT1NUID0+IHRydWUsCgkJQ1VSTE9Q
VF9QT1NURklFTERTID0+ICRwb3N0X3N0cmluZywKCQlDVVJMT1BUX1VTRVJBR0VOVCA9PiAk
dGhpcy0+dXNlcl9hZ2VudCk7CgoJCSRjaCA9IGN1cmxfaW5pdCgpOwoJCWN1cmxfc2V0b3B0
X2FycmF5KCRjaCwgJG9wdGlvbnMpOwoKCQkkcmVzcG9uc2UgPSBjdXJsX2V4ZWMoJGNoKTsK
CQkkdGhpcy0+bGFzdF9yZXNwb25zZSA9ICRyZXNwb25zZTsKCQkkaW5mbyA9IGN1cmxfZ2V0
aW5mbygkY2gpOwoKCQljdXJsX2Nsb3NlKCRjaCk7CgoJCS8vIGFsbCBnb29kCgkJaWYgKCRp
bmZvWydodHRwX2NvZGUnXSA9PSAyMDQpCgkJCXJldHVybiB0cnVlOwoJCXJldHVybiBmYWxz
ZTsKCX0KfQoiO3M6MzoibWQ1IjtzOjMyOiIzMDlhYWNjNDQ3NzMyOTE4YTQyNjI3ZTVlYTg0
MDIyZiI7fQ==